<mat-card class="patient-details-card">
  <mat-card-header>
    <mat-card-title>Detalles del Paciente</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <div class="patient-details-container">
      <div class="patient-header">
        <div class="patient-avatar">
          <mat-icon class="avatar-icon">person</mat-icon>
        </div>
        <div class="patient-name-age">
          <h3 class="patient-name">{{ patient.person.firstName }} {{ patient.person.lastName }}</h3>
          <p class="patient-age">Edad: 30</p>
        </div>
      </div>

      <div class="patient-info-grid">
        <div class="info-item">
          <strong class="label">Género:</strong> {{ getGenderDisplay(patient.person.gender) || 'Femenino' }}
        </div>
        <div class="info-item">
          <strong class="label">Teléfono:</strong> {{ patient.person.phone || '123-456-7890' }}
        </div>
        <div class="info-item">
          <strong class="label">Email:</strong> {{ patient.person.email || 'paciente@ejemplo.com' }}
        </div>
        <div class="info-item">
          <strong class="label">Dirección:</strong> {{ patient.person.address || 'Calle Principal 123' }}
        </div>
        <div class="info-item">
          <strong class="label">Fecha de Creación:</strong> {{ patient.createdAt | date: 'short' }}
        </div>
        <div class="info-item">
          <strong class="label">Última Actualización:</strong> {{ patient.updatedAt | date: 'short' }}
        </div>
        <div class="info-item" style="grid-column: 1 / -1;">
          <strong class="label">Historial Médico:</strong> {{ 'Sin historial disponible' }}
        </div>
      </div>

      <div class="consultations-section">
        <h3>Consultas</h3>
        <button mat-raised-button color="accent" (click)="toggleNewConsultation()">Nueva Consulta</button>

        <div *ngIf="showNewConsultation">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Motivo de Consulta</mat-label>
            <textarea matInput [(ngModel)]="newConsultation.reason"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Detalle de Consulta</mat-label>
            <textarea matInput [(ngModel)]="newConsultation.details"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notas</mat-label>
            <textarea matInput [(ngModel)]="newConsultation.notes"></textarea>
          </mat-form-field>

          <button mat-raised-button color="primary" (click)="addConsultation()">Guardar Consulta</button>
        </div>

        <h3>
          Consultas pasadas
        </h3>
        <mat-list class="consultations-list">
          <mat-list-item *ngFor="let consultation of patient.consultations" (click)="showConsultationDetails(consultation)" class="consultation-item">
            <div class="consultation-content">
              <mat-icon mat-list-icon>chevron_right</mat-icon>
              <div class="container-data">
                <div mat-line class="consultation-reason">{{ consultation.reason }}</div>
                <div mat-line class="consultation-date">Fecha: {{ consultation.date | date: 'short' }}</div>
              </div>
            </div>   
          </mat-list-item>
        </mat-list>
        <div #consultationDetailsContainer>
          <mat-card class="patient-details-card" *ngIf="selectedConsultation" #consultationDetailsCard>
              <mat-card-header>
                  <mat-card-title>Detalles del Paciente</mat-card-title>
              </mat-card-header>

              <mat-card class="patient-details-card">
                  <div class="consultations-section">
                      <div class="consultation-details">
                          <h4>Detalles de la Consulta</h4>
                          <div class="chalkboard">
                              <table class="consultation-table">
                                  <tr>
                                      <td><strong>Motivo:</strong></td>
                                      <td>{{ selectedConsultation.reason }}</td>
                                  </tr>
                                  <tr>
                                      <td><strong>Detalle:</strong></td>
                                      <td>{{ selectedConsultation.details }}</td>
                                  </tr>
                              </table>
                              <div class="post-it" style="transform: rotate(1deg);">
                                  <p><strong>Notas:</strong> {{ selectedConsultation.notes }}</p>
                              </div>
                          </div>
                      </div>
                  </div>
              </mat-card>

              <mat-card-actions class="patient-actions">
              </mat-card-actions>
          </mat-card>
      </div>
      </div>
    </div>
  </mat-card-content>

  <mat-card-actions class="patient-actions">
    <button mat-raised-button color="primary">Editar</button>
    <button mat-raised-button color="primary" (click)="viewAgenda(patient)">Agendar</button>
    <button mat-raised-button color="warn">Eliminar</button>
  </mat-card-actions>
</mat-card>